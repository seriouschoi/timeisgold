# 관계와 계약 확정

VO, Entity 리팩토링은 이미 끝났고,  
이제 구조가 크게 바뀔 일은 많지 않을 것으로 본다.

문제는 여기까지 오면서 사이드 이펙트가 너무 커졌다는 점이다.  
앱을 계속 실행해서 손으로 테스트하는 방식으로는 더 이상 버티기 어렵다.

지금부터의 방향은 이걸로 잡는다.

1. 각 모듈, 각 계층 사이의 관계를 "계약" 관점에서 다시 본다
    - 어떤 입력을 받는지
    - 어떤 출력을 내보내는지
    - 어떤 에러를 어떤 형태로 전달하는지
    - 어떤 상태/불변조건을 보장해야 하는지

2. 이 계약을 코드 상에서 명시한다
    - 인터페이스, usecase 시그니처, 반환 타입, 에러 타입
    - 도메인 규칙을 주석이나 테스트 이름 수준까지 적어둔다

3. 계약을 기준으로 테스트를 작성한다
    - 구현체 내부 동작을 검증하기보다,  
      "계약을 만족하는지"를 보는 테스트를 만든다

4. 테스트를 통과하는 방향으로 구현을 정리한다
    - 기존 구현이 애매하면, 일단 구현은 무시하고 계약부터 고정한다
    - 그 다음 구현을 계약에 맞게 고쳐 나간다

요약하면:

- 지금까지는 구현을 먼저 바꾸고, 눈으로 확인하면서 따라갔다
- 이제부터는  
  구현보다 계약을 먼저 확정하고,  
  계약에 맞게 구현을 맞추고,  
  그 계약을 테스트로 자동 검증하는 단계로 넘어간다