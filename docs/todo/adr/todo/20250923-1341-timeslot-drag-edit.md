# 타임 슬롯 목록에서 타임 슬롯을 드래그하여 시간을 변경한다.

1. [ ] 시간이 겹칠 경우 예외 처리.
   1. 시간이 겹치기 전까지만 드래그를 허용.
      1. 핸들 드래그.
   2. 시간이 겹치게 되면, 순서를 바꾸기.
      1. 카드를 드래그 할때만 이 규칙을 쓰는게 좋을듯.
      2. ~~[ ] 이걸 제대로 구현하려면...스크롤이 알아서 위로 같이 올라가는게 좋을것 같은데..~~
      3. 사용자가 드래그중 자꾸 배경 요소가 바뀌게 되면, 원치 않는 동작으로 스트레스를 받게 됨.
         1. 차라리 겹친 요소를 색으로 표시하자.(저장하지 못한 요소라고 표시해야지.)


1. [x] 자정을 걸친 타음 슬롯의 처리.
   1. 이슈.
      1. 24:00은 00:00이다..때문에.. timeSlot을 23:00~00:00을 하게 될 경우, 예외가 발생.
   2. 해결.
      1. 애초에 잘못된 정의다. 수면시간은 자정을 넘겨서 타임슬롯을 설정할 수도 있다.
      2. end가 start보다 작으면 타임슬롯 카드를 두개 그림. 
         1. 00:00 ~ end
         2. start ~ 24:00
      3. 즉 같은 타임슬롯의 카드뷰를 두개를 만들어야 하므로, 실질적인 EntityCardView와 DraggableCardView로 나눈다.   

자꾸 저장된 시간이 아니라 드래그 된 시간만 보인다.
1. dragStop
2. uiState changed 
3. show card
   1. show card. title=ㅊ, draggableStartMinutes=856, draggableEndMinutes=1199, startMinutes=855, endMinutes=1200
   2. 이게 문제네. startTime이 새로오면,  draggableStartMinutes도 갱신되야 하는거 아닌가?
   3. remember에 키를 전달했더니... 이젠 드래그가 실시간으로 안 먹네. ㅋㅋㅋㅋㅋ
   4. 원인은, state reset문제.
      1. 첫번째 드래그 시도에서는 잘 동작한다.
         1. 왜냐하면, 처음 remember로 초기화 되었고, 이후 드래그에 의해 값이 계속 갱신될것이다.
         2. 외부에서 startMinute가 바뀌면서, draggableStartMinutes가 다른 값이 됨.
         3. 하지만 드래그 콜백에선 이전 값을 기준으로 계산을 계속 하고 있음.(이건 컴포즈 안에 콜백을 쓰는데 컴포저블 함수 안의 요소를 쓸 경우 문제같다.)
         4. 그 후에 드래그를 아무리 시도해도, 새로운 key에 의해 타임슬롯에 저장된 startTime은 갱신되지 않음.
      5. 해결책은, 차라리 startMinutes 들의 remember키를 제거하고, 이걸 초기화 하는 LaunchEffect에 키를 줘서 초기화 하는 것이다.
      6. 근데 위의 과정이 어떻게 해도 지저분하니깐 사실, 인텐트가 폭주되더라도, 뷰모델에 이걸 전달해서 드래그하는 상태도 실시간으로 뷰모델의 상태를 갱신하게 만드는게 가장 좋을것 같다.
4. update timeslot success
5. recieved routine composition
6. uiState changed.
7. 어..? 카드가 갱신이 안되는데..?

   


1. 뷰가 상태를 들고 있고, 함수를 들고 있으면서, UI가 더이상 순수 함수가 아니게 된것 같다...


1. [x] 상단 하단에 핸들 추가해서 잡고 늘리면, 시간 늘어나게 만들자.
2. [x] 슬롯을 드래그 할때 시간 텍스트 실시간 갱신.
   1. [x] 갱신하면서, 뷰크기 조정을 차라리 실시간 시간 기반으로.
3. [x] 롱탭을 헀을때만 스크롤 되게 만들자.